const canvas = document.querySelector('canvas');
const context = canvas.getContext('2d');
const input = document.querySelector('input');
const phrase = document.querySelector('h2');

const fontSize = 20;
const fontColor = '#0f0';
const textSymbols =
  '1111640401671411630401410401501651471450540401641671570551471511621641500401571411530540401671511641500401421571651471501630401421621571531451560401571461460540401411601601411621451561641541710401541571561470401411471570540401411561440401671511641500401421621571531451560401421411621530540401571661451621471621571671560401671511641500401571541440401631571621451630560560401271511641500401501511630401501651471450540401431541651551631511541710540401411631711551551451641621511431411541541710401631601621451411440401471561411621541451440401501411561441630401411561440401461511561471451621630540401501450401631641571571440401541511531450401411560401571541440540401411561471621710401411561440401431571561641451551601641651571651630401461621451411530401421451641671451451560401641501450401631551511541511561470401421511621431501451630560401221451601541411710561111640401671411630401410401501651471450540401641671570551471511621641500401571411530540401671511641500401421571651471501630401421621571531451560401571461460540401411601601411621451561641541710401541571561470401411471570540401411561440401671511641500401421621571531451560401421411621530540401571661451621471621571671560401671511641500401571541440401631571621451630560560401271511641500401501511630401501651471450540401431541651551631511541710540401411631711551551451641621511431411541541710401631601621451411440401471561411621541451440401501411561441630401411561440401461511561471451621630540401501450401631641571571440401541511531450401411560401571541440540401411561471621710401411561440401431571561641451551601641651571651630401461621451411530401421451641671451451560401641501450401631551511541511561470401421511621431501451630561231507'.split(
    '',
  );
const inputMaxLength = 6;
const columns = Math.round(window.innerWidth / fontSize) - 1;

let inputX = 0;
let inputY = 0;

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

animate();

function sleep(ms) {
  return new Promise((resolve) => setTimeout(resolve, ms));
}

function drawNumber(txt, x, y) {
  context.font = `${fontSize}px system-ui`;
  context.fillStyle = fontColor;
  context.fillText(txt, x * fontSize, y * fontSize);
}

async function animate() {
  let x = 1;
  let y = 1;
  for (let txt of textSymbols) {
    drawNumber(txt, x, y);
    await sleep(0.01);
    x++;
    if (x >= columns) {
      y++;
      x = 1;
    }
  }

  inputX = x;
  inputY = y - 1;

  addInput();
}

function addInput() {
  input.style.top = inputY * fontSize + 'px';
  input.style.left = inputX * fontSize + 'px';
  input.style.width = inputMaxLength * fontSize + 'px';
  input.classList.remove('none');
  input.focus();
}

async function deleteNumbers() {
  for (let y = inputY; y >= 0; y--) {
    for (let x = columns; x > 0; x--) {
      context.fillStyle = 'black';
      context.fillRect(x * fontSize, y * fontSize, fontSize, fontSize);
      await sleep(0.01);
    }
  }
  phrase.classList.remove('none');
}

let inputValue = '';
input.addEventListener('input', async (event) => {
  if (event.data) {
    inputValue += event.data;
  } else {
    inputValue = inputValue.slice(0, -1);
  }

  if (inputValue == '051321') {
    input.value = '';
    input.blur();
    await deleteNumbers();
  }
});
